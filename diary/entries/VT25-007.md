<!--- metadata

title: H4 - NFC ja RFID
date: 29.11.2025
slug:
id: ICI013AS3A-3002
week: Week 48
summary: Kirjoituksessa tarkastellaan arkipäivän RFID-käyttöjä ja niiden suojausta, APDU-komentojen rakennetta ja yleisiä komentoja, sekä kuvataan KioSoftin MIFARE Classic -korttien haavoittuvuus ja sen hyväksikäyttö.
tags: [ "ICI013AS3A-3002", "Network Attacks"]

--->

## a) Tarkastele käytössäsi olevia RFID tuotteita, mieti miten hyvin olet suojautunut RFID urkinnalta?

Kun aloin miettimään missä kaikkialla arjessa käytän RFID siruja, niin aika monessa asiassa viikon aikana tulee käytettyä niitä. Avaimet on yksi sellainen mitä käytän päivittäin ja mulla on käytössä iLoq avain, niin se käyttää RFID sirua. Kuitenkin tämä on järjestelmä, minkä vaikka avaimen kopioisikin niin sen käyttö perustuu järjestelmään ohjelmoidulla perjaatteella, eli jos joku mun avaimen kopioiskin, niin se ei sillä mitään tekisi, ellei sillä ole pääsyä itse järjestelmään, missä se voi muuttaa UID:n jokski muuksi tai muuten ohjelmoida järjestelmässä avaimen oikeuksia. Eli tämä on aika hyvin suojattu jo valmiiksi, eikä tästä tarvii olla huolissaan.

Toinen missä tuli käytettyä tällä viikolla RFID sirua oli passi. Mutta tässä sama homma, eli tämäkin perustuu siihen että itse järjestelmä hallinnoi sitä salaista dataa, niin vaikka joku sen tagin skannaisikin, sen pitäisi tehdä paljon kaikkea muuta ennen kun siitä hänelle olisi mitään hyötyä. Ja muutenkin en kanna passia ikinä missään mukana ellei ole pakko, niin se vaikeuttaa sirun skannaamistakin.

Viimeinen missä itsellä on arjessa käytössä olevia RFID siruja on kaikki maksukortit mitkä löytyy lompakosta ja puhelin. Lompakko on ehkä se heikoin lenkki tässä yhtälössä, mutta tähän olenkin varautunut, sillä mulla on RFID ja muita signaaleja estävä lompakko, eli sen läpi mitään ei pysty skannaamaan tai lähettämään signaaleja. Tätä olen testannut ja se toimii yllättävän hyvin. Tosin, multa ei löydy mitään älyttömän kalliita hi-tech skannereita, eli en tiedä että murtuisko se sitten jossakin ammattilais testailussa.

Ja viimeisenä puhelimen RFID lähimaksua varten. Koska mulla on Iphone puhelin, on siihen rakennettu `Secure Element` kryptosiru, mikä hallinnoi kaikkea esimerkiksi apple pay:n toimintoja. Tämä pitäisi olla ihan standardi jokaisessa puhelimessa, mutta se ei ihan aina toteudu esimerkiksi android puhelimilla. Eli Apple ei anna ikinä mitään hardware tason koodeja sovellusten käyttöön ja kaikki tapahtuu iOS:n kautta, mikä estää kaiken maailman kiertelyt ja kaartelut.

Muutenkin `Secure Element` on loistava tapa hallinnoida lähimaksu tapahtumia. Se ei ikinä anna eteenpäin suoraa korttitietoja, se tekee aina dynaamisen kryptokrafisen allekirjoituksen jokaisella tapahtumalla, se ei oo yhteydessä mihinkään servereihin eli kaikki tapahtuu itse sirulla ja se on vielä kaiken lisäksi fyysisesti eristetty kaikesta muusta, eli vähän sama kun joku SIM kortti. Eli sinne ei pääse mitenkään käsiks, eikä sitä pysty mitenkään manipuloimaan. Ainakaan tällä hetkellä tiedetysti. Niin silläkin puolella ollaan ihan turvassa.

---

## b) Tutustu APDU komentojen rakenteeseen (voit käyttää tekoälyä tutustumiseen)

Aiheesta löysin tosi hyvän lähteen [CardLogix.com](https://www.cardlogix.com/glossary/apdu-application-protocol-data-unit-smart-card/) missä kerrottiin koko protokollan sisältö todella selkeesti. Ja toinen sivu missä oli itse komentojen sisällöistä tietoa, ja taas kerran tosi hyvin avattu, mitä ja miten nämä itse komennot toimivat ja mikä niiden käyttötarkoitus on. [CardWerk.com](https://cardwerk.com/smart-card-standard-iso7816-4-section-6-basic-interindustry-commands/)

APDU-viestit jakautuvat siis käytännössä kahteen päätyyppiin: komentoviestiin `Command APDU` ja vastausviestiin `Response APDU`. Kommentoissa on aina pakollinen header osio, joka sisältää luokan (CLA), itse komennon (INS) sekä kaksi parametria (P1 ja P2). Lisäksi komentoon voi kuulua optioina datakenttä, jonka pituus ilmoitetaan Lc-kentässä, ja Le-kenttä, joka määrittää vastauksena odotettavan datamäärän, maksimissaan kuitenkin `255 bytea`.

Vastausviesti muodostuu vapaaehtoisesta datakentästä ja kahdesta pakollisesta status sanaa sisältävästä baitista esimerkiksi `0x9000` tarkoittaa onnistunutta toimitusta. Status sana siis kertoo tapahtuman tilan.

Tässä vielä yleisimmät komennot mitä APDU käyttää:

```py
SELECT FILE (0x00A4)
READ BINARY (0x00B0)
UPDATE BINARY (0x00D6)
READ RECORDS (0x00B2)
UPDATE RECORDS (0x00DC)
APPEND RECORD (0x00E2)
VERIFY (0x0020)
CHANGE REFERENCE DATA (0x0024)
RESET RETRY COUNTER (0x002C)
GET CHALLENGE (0x0084)
INTERNAL AUTHENTICATE (0x0088)
EXTERNAL AUTHENTICATE (0x0082)
TERMINATE CARD USAGE (0x826E)
ERASE BINARY (0x00DA)
ERASE RECORDS (0x00DC)
```

---

## c) Tutki ja kerro minkä mielenkiintoisen RFID hakkerointi uutisen löysit. (Vinkki, useimmat liittyvät henkilökortteihin)

Löysin erittäin mielenkiintoisen uutisen siitä miten KioSoft:in prepaid NFC korttien saldoja pystyttiin muuntelemaan. Näitä kortteja käytetään siis esimerkiksi pesuloissa, snäkki automaateilla, pelihalleissa ja autopesuloissa.

Tämän vian löysi SEC Consult ja ne raportoi tästä ensimmäisen kerran 2023 syksyllä. Ja tässä siis haavoittuvuus oli siinä että näissä korteissa käytettiin vanhaa MIFARE Classic ratkaisua, ja sen CRYPTO1 kryptokrafia ratkaisua. Tämä on murrettu jo onnistuneesti 2007-2008 vuosina, eikä ole ollut turvallinen semmoisenaan siitä lähtien.

Ongelma tässä oli, että kaikki autentikaatio ja data oli vain kortilla eikä korttia validoitu missään järjestelmässä. Eli ei ollut minkään sortin varmistusta siitä että pitääkö kortilla oleva data paikkaansa vai ei. Näin ollen siis SEC Consult onnistui murtamaan salauksen, ja pystyi lukemaan ja kirjoittamaan saldoa useita kertoja, eli käytännössä loputtomasti. Saldoa voitiin kerralla kuitenkin kasvattaa vain $655 asti.

Onneksi tämä oli haavoittuvuus, mikä löytyi tietoturva asiantuntijoiden toimesta, niin tiedettävästi tässä tapauksessa ei ollut uhreja. Nimittäin tämä olisi voinut olla erittäin kallis menetys niin yrityksille, jotka käytti kyseistä järjestelmää kuten myös itse KioSoft:ille, joka olisi varmasti uponnut lakiongelmiin ja kulukorvauksiin.

---

### Lähteet

#### 1. Karvinen 2025. Verkkoon tunkeutuminen ja tiedustelu. Luettavissa: [[https://terokarvinen.com/verkkoon-tunkeutuminen-ja-tiedustelu/]] Luettu: 29.11.2025

#### 2. CardLogix s.a. Application Protocol Data Unit (APDU). Luettavissa: [[https://www.cardlogix.com/glossary/apdu-application-protocol-data-unit-smart-card/]] Luettu: 29.11.2025

#### 3. CardWerk s.a. ISO 7816-4 Section 6 - Basic Interindustry Commands. Luettavissa: [[https://cardwerk.com/smart-card-standard-iso7816-4-section-6-basic-interindustry-commands/]] Luettu: 29.11.2025

#### 4. CyberSecureFox 2025. KioSoft CVE-2025-8699: Vulnerable Prepaid NFC Cards Abused to Inflate Balances, Patch Arrived a Year Later. Luettavissa: [[https://cybersecurefox.com/en/kiosoft-cve-2025-8699-mifare-classic-prepaid-card-vulnerability/?utm_source=chatgpt.com]] Luettu: 29.11.2025
